# üß™ Experimentos de Validaci√≥n ‚Äì Neptunik

## üéØ Objetivo
Dise√±ar y ejecutar experimentos sistem√°ticos para validar hip√≥tesis cr√≠ticas del negocio antes de invertir en desarrollo del producto.

---

## üìã Hip√≥tesis a Validar

### Hip√≥tesis Principales

```yaml
H1 - Problema/Soluci√≥n Fit:
  hip√≥tesis: "Las pymes gastan >3h/semana gestionando WhatsApp manualmente"
  m√©trica: "% que confirma problema en interviews"
  criterio_√©xito: ">70% confirma"
  m√©todo: "Customer interviews"

H2 - Disposici√≥n de Pago:
  hip√≥tesis: "Pymes pagar√°n ‚Ç¨20-40/mes por automatizaci√≥n WhatsApp"
  m√©trica: "% dispuesto a pagar en rango objetivo"
  criterio_√©xito: ">30% acepta pricing"
  m√©todo: "Pricing experiments + Van Westendorp"

H3 - Canal de Adquisici√≥n:
  hip√≥tesis: "Podemos adquirir leads por <‚Ç¨50 v√≠a paid ads"
  m√©trica: "CPL real en campa√±as"
  criterio_√©xito: "CPL <‚Ç¨50"
  m√©todo: "Google/Meta Ads campaigns"

H4 - Conversi√≥n Landing:
  hip√≥tesis: "Landing convertir√° >2% visitantes a leads"
  m√©trica: "Conversion rate real"
  criterio_√©xito: ">2%"
  m√©todo: "A/B testing landing variants"

H5 - Calidad de Leads:
  hip√≥tesis: "Targeting generar√° >40% leads cualificados"
  m√©trica: "% leads con score >60"
  criterio_√©xito: ">40% cualificados"
  m√©todo: "Lead scoring + qualification calls"
```

---

## üöÄ Experimento 1: Validaci√≥n de Demanda (Semanas 1-2)

### Setup de Landing Page

```javascript
// Variantes de Landing para Test
const landingVariants = {
  // Variante A: Enfoque en Beneficios
  variantA: {
    headline: "Multiplica tus ventas con WhatsApp automatizado",
    subheadline: "Convierte cada mensaje en una oportunidad de negocio",
    value_props: [
      "Aumenta ventas hasta 30%",
      "Ahorra 10 horas semanales",
      "Responde 24/7 autom√°ticamente"
    ],
    cta_primary: "Empieza prueba gratuita",
    cta_secondary: "Ver casos de √©xito",
    social_proof: "testimonials",
    urgency: "limited_spots"
  },
  
  // Variante B: Enfoque en Simplicidad
  variantB: {
    headline: "WhatsApp Business API en 5 minutos, sin programar",
    subheadline: "La forma m√°s simple de profesionalizar tu WhatsApp",
    value_props: [
      "Configuraci√≥n en 5 minutos",
      "Sin conocimientos t√©cnicos",
      "Soporte en espa√±ol 24/7"
    ],
    cta_primary: "Configurar ahora",
    cta_secondary: "Ver demo en vivo",
    social_proof: "customer_logos",
    urgency: "discount_early_adopters"
  },
  
  // Variante C: Enfoque en Dolor
  variantC: {
    headline: "¬øPerdiendo clientes por no responder a tiempo?",
    subheadline: "Automatiza WhatsApp y nunca pierdas otra venta",
    value_props: [
      "Respuesta instant√°nea 24/7",
      "Gesti√≥n de m√∫ltiples conversaciones",
      "Seguimiento autom√°tico de clientes"
    ],
    cta_primary: "Solucionar ahora",
    cta_secondary: "Calcular p√©rdidas",
    social_proof: "success_metrics",
    urgency: "competitor_comparison"
  }
};
```

### Configuraci√≥n de Tracking

```javascript
// Implementaci√≥n de tracking para experimentos
class ExperimentTracker {
  constructor() {
    this.experimentId = this.getOrAssignExperiment();
    this.variant = this.getVariant();
    this.sessionStart = Date.now();
  }
  
  getOrAssignExperiment() {
    let experimentId = localStorage.getItem('experiment_id');
    if (!experimentId) {
      experimentId = crypto.randomUUID();
      localStorage.setItem('experiment_id', experimentId);
    }
    return experimentId;
  }
  
  getVariant() {
    // Distribuci√≥n uniforme entre variantes
    const variants = ['A', 'B', 'C'];
    const hash = this.hashCode(this.experimentId);
    return variants[hash % variants.length];
  }
  
  trackEvent(eventName, properties = {}) {
    const event = {
      experiment_id: this.experimentId,
      variant: this.variant,
      event_name: eventName,
      timestamp: Date.now(),
      session_duration: Date.now() - this.sessionStart,
      ...properties
    };
    
    // Send to analytics
    gtag('event', eventName, event);
    mixpanel.track(eventName, event);
    this.sendToSupabase(event);
  }
  
  trackMicroConversion(type) {
    const microConversions = {
      scroll_pricing: { value: 1, intent: 'medium' },
      watch_demo: { value: 2, intent: 'high' },
      click_testimonial: { value: 1, intent: 'low' },
      faq_interaction: { value: 1, intent: 'medium' },
      pricing_calculator: { value: 3, intent: 'high' },
      chat_initiated: { value: 3, intent: 'high' }
    };
    
    const conversion = microConversions[type];
    this.trackEvent('micro_conversion', {
      type,
      ...conversion
    });
  }
}
```

---

## üí∞ Experimento 2: Pricing Validation (Semanas 2-3)

### Van Westendorp Price Sensitivity

```javascript
// Survey questions for pricing research
const pricingSurvey = {
  questions: [
    {
      id: 'too_cheap',
      text: '¬øA qu√© precio considerar√≠as que el servicio es TAN BARATO que dudar√≠as de su calidad?',
      type: 'currency',
      min: 0,
      max: 100
    },
    {
      id: 'cheap',
      text: '¬øA qu√© precio considerar√≠as que el servicio es una GANGA - una gran compra por el dinero?',
      type: 'currency',
      min: 0,
      max: 100
    },
    {
      id: 'expensive',
      text: '¬øA qu√© precio empezar√≠as a considerar que el servicio es CARO, pero a√∫n podr√≠as considerarlo?',
      type: 'currency',
      min: 0,
      max: 100
    },
    {
      id: 'too_expensive',
      text: '¬øA qu√© precio considerar√≠as que el servicio es TAN CARO que no lo considerar√≠as?',
      type: 'currency',
      min: 0,
      max: 100
    }
  ],
  
  followUp: [
    {
      id: 'features_most_valuable',
      text: '¬øQu√© caracter√≠sticas valorar√≠as m√°s? (Selecciona hasta 3)',
      type: 'multi_select',
      options: [
        'Respuestas autom√°ticas IA',
        'Gesti√≥n de citas/reservas',
        'Env√≠o masivo de mensajes',
        'Integraci√≥n con CRM',
        'Analytics detallados',
        'Plantillas personalizadas',
        'Multi-agente',
        'API para integraciones'
      ]
    },
    {
      id: 'current_spending',
      text: '¬øCu√°nto gastas actualmente en herramientas de marketing/comunicaci√≥n?',
      type: 'range',
      options: ['‚Ç¨0-50', '‚Ç¨51-100', '‚Ç¨101-200', '‚Ç¨200+']
    }
  ]
};

// An√°lisis de resultados Van Westendorp
function analyzeVanWestendorp(responses) {
  const prices = {
    too_cheap: responses.map(r => r.too_cheap).sort((a,b) => a-b),
    cheap: responses.map(r => r.cheap).sort((a,b) => a-b),
    expensive: responses.map(r => r.expensive).sort((a,b) => a-b),
    too_expensive: responses.map(r => r.too_expensive).sort((a,b) => a-b)
  };
  
  // Calcular puntos de intersecci√≥n
  const opp = findIntersection(prices.too_cheap, prices.expensive); // Optimal Price Point
  const ipp = findIntersection(prices.cheap, prices.too_expensive); // Indifference Price Point
  const pmf = findIntersection(prices.cheap, prices.expensive); // Point of Marginal Cheapness
  const pme = findIntersection(prices.too_cheap, prices.too_expensive); // Point of Marginal Expensiveness
  
  return {
    optimal_price: opp,
    acceptable_range: { min: pmf, max: pme },
    indifference_price: ipp,
    recommendation: determinePrice(opp, ipp, pmf, pme)
  };
}
```

### A/B Test de Pricing en Landing

```javascript
// Configuraci√≥n de test de pricing
const pricingTests = {
  // Test 1: Precio base
  control: {
    starter: { price: 20, features: 3, messages: 1000 },
    pro: { price: 40, features: 7, messages: 3000 },
    enterprise: { price: 'Custom', features: 'all', messages: 'unlimited' }
  },
  
  // Test 2: Precio premium
  variant_premium: {
    starter: { price: 29, features: 4, messages: 1500 },
    pro: { price: 59, features: 8, messages: 5000 },
    enterprise: { price: 'Custom', features: 'all', messages: 'unlimited' }
  },
  
  // Test 3: Precio agresivo
  variant_aggressive: {
    starter: { price: 15, features: 3, messages: 750 },
    pro: { price: 35, features: 6, messages: 2500 },
    enterprise: { price: 99, features: 'all', messages: 10000 }
  },
  
  // Test 4: Freemium
  variant_freemium: {
    free: { price: 0, features: 2, messages: 100 },
    growth: { price: 25, features: 5, messages: 2000 },
    scale: { price: 75, features: 'all', messages: 'unlimited' }
  }
};

// Tracking de interacciones con pricing
function trackPricingInteraction(action, details) {
  const pricingEvents = {
    view_pricing: () => {
      startTime = Date.now();
      hoveredPlans = [];
    },
    
    hover_plan: (plan) => {
      hoveredPlans.push({
        plan: plan,
        duration: Date.now() - lastHover
      });
      lastHover = Date.now();
    },
    
    compare_plans: (plans) => {
      track('pricing_comparison', {
        plans_compared: plans,
        comparison_duration: Date.now() - startTime
      });
    },
    
    select_plan: (plan) => {
      track('plan_selected', {
        plan_name: plan.name,
        price: plan.price,
        time_to_select: Date.now() - startTime,
        plans_considered: hoveredPlans
      });
    }
  };
  
  pricingEvents[action](details);
}
```

---

## üì± Experimento 3: Canales de Adquisici√≥n (Semanas 2-4)

### Google Ads Campaigns

```yaml
Campaign Structure:
  
  Campaign_1_Search:
    name: "Search - High Intent"
    budget: ‚Ç¨30/day
    bidding: "Maximize conversions"
    
    Ad_Groups:
      WhatsApp_API:
        keywords:
          - "whatsapp business api"
          - "whatsapp cloud api"
          - "api whatsapp empresa"
          - "+whatsapp +api +negocio"
        match_types: ["exact", "phrase"]
        
      Automation:
        keywords:
          - "automatizar whatsapp"
          - "chatbot whatsapp empresa"
          - "respuestas autom√°ticas whatsapp"
        match_types: ["phrase", "broad modified"]
        
      Industry_Specific:
        keywords:
          - "whatsapp restaurante"
          - "whatsapp dentista"
          - "gesti√≥n citas whatsapp"
        match_types: ["phrase"]
    
    Ad_Copy_Tests:
      Test_A_Benefits:
        headline1: "WhatsApp Business Automatizado"
        headline2: "Aumenta Ventas 30% | Sin Programar"
        headline3: "Configuraci√≥n 5 Minutos"
        description1: "Automatiza respuestas, gestiona citas y aumenta ventas."
        description2: "Prueba gratis 14 d√≠as. Soporte en espa√±ol 24/7."
        
      Test_B_Pain_Points:
        headline1: "¬øPerdiendo Clientes en WhatsApp?"
        headline2: "Responde 24/7 Autom√°ticamente"
        headline3: "Sin Conocimientos T√©cnicos"
        description1: "Nunca pierdas otra venta. Respuestas instant√°neas."
        description2: "Configuraci√≥n simple. Resultados desde d√≠a 1."

  Campaign_2_Display:
    name: "Display - Remarketing"
    budget: ‚Ç¨15/day
    audiences:
      - "Website visitors (all)"
      - "Pricing page viewers"
      - "Form abandoners"
```

### Meta Ads Campaigns

```javascript
// Configuraci√≥n de campa√±as Meta
const metaCampaigns = {
  campaign_1_conversions: {
    objective: 'CONVERSIONS',
    optimization_goal: 'LEAD_GENERATION',
    daily_budget: 25,
    
    audiences: [
      {
        name: 'Restaurants_Owners',
        targeting: {
          geo_locations: {
            countries: ['ES'],
            cities: [
              { key: '788325', name: 'Madrid' },
              { key: '1038678', name: 'Barcelona' }
            ]
          },
          age_min: 25,
          age_max: 55,
          genders: ['male', 'female'],
          detailed_targeting: {
            interests: [
              { id: '6003277229371', name: 'Restaurant management' },
              { id: '6003384099610', name: 'Food delivery service' }
            ],
            behaviors: [
              { id: '6002714895372', name: 'Small business owners' }
            ]
          },
          exclusions: {
            custom_audiences: ['existing_customers']
          }
        }
      },
      {
        name: 'Dental_Clinics',
        targeting: {
          geo_locations: { countries: ['ES'] },
          detailed_targeting: {
            interests: [
              { id: '6003176678152', name: 'Dentistry' }
            ],
            work_positions: [
              { id: '755235914557299', name: 'Dentist' },
              { id: '1030193920368790', name: 'Clinic Manager' }
            ]
          }
        }
      }
    ],
    
    creatives: [
      {
        format: 'SINGLE_IMAGE',
        primary_text: 'üöÄ Automatiza WhatsApp y multiplica tus reservas',
        headline: 'WhatsApp Business en 5 minutos',
        description: 'Sin programar. Prueba gratis.',
        cta: 'LEARN_MORE'
      },
      {
        format: 'CAROUSEL',
        cards: [
          {
            headline: 'Responde 24/7',
            description: 'IA que entiende a tus clientes'
          },
          {
            headline: 'Gestiona Reservas',
            description: 'Calendario integrado autom√°tico'
          },
          {
            headline: 'Aumenta Ventas 30%',
            description: 'Casos de √©xito reales'
          }
        ]
      }
    ]
  }
};

// Tracking de performance por creatividad
function trackCreativePerformance(campaignId, creativeId, metrics) {
  const performance = {
    campaign_id: campaignId,
    creative_id: creativeId,
    impressions: metrics.impressions,
    clicks: metrics.clicks,
    ctr: (metrics.clicks / metrics.impressions) * 100,
    conversions: metrics.conversions,
    conversion_rate: (metrics.conversions / metrics.clicks) * 100,
    cpl: metrics.spend / metrics.conversions,
    relevance_score: metrics.relevance_score
  };
  
  // Decisi√≥n autom√°tica
  if (performance.ctr < 0.5) {
    return { action: 'pause', reason: 'low_ctr' };
  }
  if (performance.cpl > 75) {
    return { action: 'decrease_bid', reason: 'high_cpl' };
  }
  if (performance.conversion_rate > 5 && performance.cpl < 30) {
    return { action: 'increase_budget', reason: 'high_performance' };
  }
  
  return { action: 'continue', reason: 'acceptable_performance' };
}
```

---

## üî¨ Experimento 4: Onboarding Flow Testing (Semanas 3-4)

### Variantes de Onboarding

```javascript
// Test de diferentes flujos de onboarding
const onboardingFlows = {
  // Flujo A: Guiado paso a paso
  flow_guided: {
    steps: [
      {
        id: 'welcome',
        title: 'Bienvenido a WhatsApp Cloud',
        content: 'Video intro 30s',
        skippable: false
      },
      {
        id: 'business_info',
        title: 'Cu√©ntanos sobre tu negocio',
        fields: ['company_name', 'industry', 'size'],
        progressive_disclosure: true
      },
      {
        id: 'whatsapp_connect',
        title: 'Conecta tu WhatsApp',
        integration: 'oauth_flow',
        help_video: true
      },
      {
        id: 'first_automation',
        title: 'Crea tu primera automatizaci√≥n',
        templates: ['welcome_message', 'out_of_hours', 'faq'],
        guided: true
      },
      {
        id: 'test_send',
        title: 'Prueba tu configuraci√≥n',
        action: 'send_test_message',
        celebration: true
      }
    ],
    estimated_time: '5 minutos',
    progress_indicator: 'steps'
  },
  
  // Flujo B: Quick setup
  flow_quick: {
    steps: [
      {
        id: 'all_in_one',
        title: 'Configuraci√≥n r√°pida',
        sections: [
          'business_info',
          'whatsapp_credentials',
          'basic_responses'
        ],
        single_page: true
      },
      {
        id: 'verify',
        title: 'Verificar y activar',
        action: 'auto_verify',
        instant_activation: true
      }
    ],
    estimated_time: '2 minutos',
    progress_indicator: 'percentage'
  },
  
  // Flujo C: Industry-specific
  flow_vertical: {
    steps: [
      {
        id: 'choose_industry',
        title: '¬øCu√°l es tu industria?',
        options: ['restaurant', 'dental', 'retail', 'other'],
        determines_flow: true
      },
      {
        id: 'industry_setup',
        title: 'Configuraci√≥n para {{industry}}',
        preloaded_templates: true,
        industry_specific_fields: true
      },
      {
        id: 'demo_data',
        title: 'Datos de ejemplo',
        action: 'load_demo_data',
        customized_to_industry: true
      }
    ],
    estimated_time: '3 minutos',
    progress_indicator: 'checklist'
  }
};

// M√©tricas de onboarding
function trackOnboardingMetrics(flow, step, action) {
  const metrics = {
    flow_type: flow,
    step_id: step.id,
    step_number: step.number,
    action: action,
    timestamp: Date.now(),
    time_on_step: Date.now() - stepStartTime,
    
    // Comportamiento del usuario
    help_clicked: helpInteractions.length > 0,
    fields_edited: editedFields.length,
    errors_encountered: errorCount,
    back_button_used: backButtonClicks > 0,
    
    // Estado de completion
    step_completed: action === 'complete',
    step_skipped: action === 'skip',
    step_abandoned: action === 'abandon'
  };
  
  // Calcular fricci√≥n
  metrics.friction_score = calculateFriction(metrics);
  
  // Enviar a analytics
  analytics.track('onboarding_step', metrics);
  
  // Alertas de abandono
  if (metrics.time_on_step > 180000) { // 3 minutos
    triggerInterventionChat();
  }
}
```

---

## üìä Experimento 5: Outbound Testing (Semanas 3-4)

### Cold Email Campaigns

```python
# Configuraci√≥n de campa√±as de cold email
email_campaigns = {
    'campaign_restaurants': {
        'segment': {
            'industry': 'restaurant',
            'size': '5-50 employees',
            'location': 'Madrid, Barcelona',
            'criteria': 'has_website AND uses_delivery_apps'
        },
        
        'sequences': [
            {
                'day': 0,
                'subject_lines': [
                    '{{restaurant_name}}, ¬øpierdes reservas por WhatsApp?',
                    'Caso: C√≥mo {{competitor}} aument√≥ reservas 40%',
                    'Pregunta r√°pida sobre {{restaurant_name}}'
                ],
                'template': 'restaurant_initial',
                'personalization': ['restaurant_name', 'neighborhood', 'cuisine_type']
            },
            {
                'day': 3,
                'subject': 'Re: {{original_subject}}',
                'template': 'restaurant_followup_1',
                'condition': 'no_reply AND email_opened'
            },
            {
                'day': 7,
                'subject': '√öltimo mensaje - {{restaurant_name}}',
                'template': 'restaurant_breakup',
                'condition': 'no_reply'
            }
        ],
        
        'metrics_to_track': {
            'open_rate': {'target': '>=40%'},
            'reply_rate': {'target': '>=5%'},
            'positive_reply_rate': {'target': '>=40% of replies'},
            'meeting_booked_rate': {'target': '>=20% of positive replies'}
        }
    }
}

# A/B tests para email copy
email_ab_tests = {
    'subject_line_test': {
        'variants': [
            {'type': 'pain', 'subject': '¬øCu√°ntas reservas pierdes por no responder WhatsApp?'},
            {'type': 'benefit', 'subject': '3 restaurantes en {{city}} aumentaron ventas 30%'},
            {'type': 'curiosity', 'subject': 'Descubrimiento sobre restaurantes en {{neighborhood}}'},
            {'type': 'personal', 'subject': '{{first_name}}, pregunta sobre {{restaurant_name}}'}
        ]
    },
    
    'opening_line_test': {
        'variants': [
            'Vi que {{restaurant_name}} tiene muy buenas rese√±as en Google...',
            'Estaba cenando en {{neighborhood}} y me preguntaba...',
            'Habl√© con {{competitor}} y me comentaron que...',
            'Not√© que responden WhatsApp manualmente...'
        ]
    }
}
```

### LinkedIn Outreach

```javascript
// Estrategia de LinkedIn outreach
const linkedInStrategy = {
  targeting: {
    titles: [
      'Restaurant Owner',
      'Restaurant Manager', 
      'Gerente de Restaurante',
      'Due√±o de Restaurante',
      'Practice Manager',
      'Clinic Director'
    ],
    companies: {
      size: '2-50 employees',
      industries: ['Restaurants', 'Food & Beverages', 'Healthcare']
    },
    geography: ['Spain', 'Mexico', 'Colombia', 'Argentina']
  },
  
  connection_request: {
    templates: [
      {
        id: 'mutual_connection',
        text: 'Hola {{first_name}}, vi que ambos conocemos a {{mutual_connection}}. Me gustar√≠a conectar para compartir insights sobre automatizaci√≥n en {{industry}}. Saludos!',
        limit: 300
      },
      {
        id: 'content_based',
        text: 'Hola {{first_name}}, me gust√≥ mucho tu post sobre {{post_topic}}. Trabajo ayudando a {{industry_plural}} a automatizar su comunicaci√≥n. ¬øPodemos conectar?',
        limit: 300
      }
    ]
  },
  
  follow_up_sequence: [
    {
      day: 1,
      condition: 'connection_accepted',
      message: 'voice_note_or_video',
      personalized: true
    },
    {
      day: 4,
      condition: 'no_reply',
      message: 'value_content',
      attachment: 'case_study_pdf'
    }
  ]
};
```

---

## üìà An√°lisis y Decisi√≥n de Experimentos

### Framework de Decisi√≥n

```python
def analyze_experiment_results(experiment_id, duration_days):
    """
    Analiza resultados y recomienda pr√≥ximos pasos
    """
    
    results = fetch_experiment_data(experiment_id, duration_days)
    
    # Calcular significancia estad√≠stica
    statistical_significance = calculate_significance(results)
    
    if statistical_significance < 0.95:
        return {
            'decision': 'CONTINUE',
            'reason': 'Insufficient data for decision',
            'recommendation': 'Run for ' + str(calculate_required_duration(results)) + ' more days'
        }
    
    # Evaluar cada hip√≥tesis
    hypothesis_results = {}
    
    # H1: Problem/Solution Fit
    if experiment_id == 'problem_validation':
        problem_confirmation_rate = results['problem_confirmed'] / results['total_interviews']
        hypothesis_results['H1'] = {
            'validated': problem_confirmation_rate >= 0.7,
            'confidence': statistical_significance,
            'metric': problem_confirmation_rate
        }
    
    # H2: Pricing
    if experiment_id == 'pricing_validation':
        willing_to_pay_rate = results['accepted_price_range'] / results['total_responses']
        hypothesis_results['H2'] = {
            'validated': willing_to_pay_rate >= 0.3,
            'confidence': statistical_significance,
            'metric': willing_to_pay_rate,
            'optimal_price': results['van_westendorp_optimal']
        }
    
    # H3: Acquisition Cost
    if experiment_id == 'acquisition_channels':
        avg_cpl = results['total_spend'] / results['qualified_leads']
        hypothesis_results['H3'] = {
            'validated': avg_cpl <= 50,
            'confidence': statistical_significance,
            'metric': avg_cpl,
            'best_channel': results['lowest_cpl_channel']
        }
    
    # Decisi√≥n final
    validated_count = sum(1 for h in hypothesis_results.values() if h['validated'])
    
    if validated_count >= 3:
        return {
            'decision': 'PROCEED_TO_MVP',
            'confidence': 'HIGH',
            'next_steps': generate_mvp_plan(hypothesis_results)
        }
    elif validated_count >= 2:
        return {
            'decision': 'PIVOT_PARTIAL',
            'confidence': 'MEDIUM',
            'pivot_areas': identify_pivot_areas(hypothesis_results)
        }
    else:
        return {
            'decision': 'PIVOT_MAJOR',
            'confidence': 'LOW',
            'recommendation': 'Consider different market or solution'
        }
```

### Dashboard de Experimentos

```sql
-- Vista consolidada de experimentos
CREATE VIEW experiment_dashboard AS
WITH experiment_metrics AS (
  SELECT 
    e.experiment_id,
    e.variant,
    COUNT(DISTINCT e.user_id) as participants,
    
    -- M√©tricas de conversi√≥n
    COUNT(DISTINCT CASE WHEN event_name = 'form_submit' THEN user_id END) as conversions,
    COUNT(DISTINCT CASE WHEN event_name = 'form_submit' THEN user_id END) * 100.0 / 
      COUNT(DISTINCT e.user_id) as conversion_rate,
    
    -- M√©tricas de engagement
    AVG(CASE WHEN event_name = 'time_on_site' THEN CAST(event_data->>'duration' AS INT) END) as avg_time_on_site,
    AVG(CASE WHEN event_name = 'pages_viewed' THEN CAST(event_data->>'count' AS INT) END) as avg_pages_viewed,
    
    -- M√©tricas de calidad
    AVG(CASE WHEN l.lead_score IS NOT NULL THEN l.lead_score END) as avg_lead_score,
    
    -- M√©tricas financieras
    SUM(COALESCE(ms.spend, 0)) / COUNT(DISTINCT CASE WHEN event_name = 'form_submit' THEN user_id END) as cpl
    
  FROM experiments e
  LEFT JOIN events ev ON e.user_id = ev.user_id
  LEFT JOIN leads l ON e.user_id = l.id
  LEFT JOIN marketing_spend ms ON DATE(e.created_at) = ms.date
  WHERE e.created_at >= CURRENT_DATE - INTERVAL '30 days'
  GROUP BY e.experiment_id, e.variant
)
SELECT 
  experiment_id,
  variant,
  participants,
  conversions,
  conversion_rate,
  avg_time_on_site,
  avg_pages_viewed,
  avg_lead_score,
  cpl,
  
  -- Statistical significance
  CASE 
    WHEN participants >= 100 AND conversion_rate > 0 THEN 
      calculate_significance(conversions, participants)
    ELSE 0
  END as statistical_significance,
  
  -- Winner determination
  CASE 
    WHEN conversion_rate = MAX(conversion_rate) OVER (PARTITION BY experiment_id) THEN TRUE
    ELSE FALSE
  END as is_winner
  
FROM experiment_metrics
ORDER BY experiment_id, conversion_rate DESC;
```

---

## üéØ Criterios de √âxito Global

### M√©tricas Go/No-Go

```yaml
Criterios para proceder con MVP:
  M√≠nimos (todos requeridos):
    - Problem validation: >70% confirma problema
    - Pricing validation: >30% acepta ‚Ç¨20-40/mes
    - Lead quality: >40% leads score >60
    - Acquisition cost: CPL <‚Ç¨50
    - Conversion rate: >1.5%
    
  Ideales (al menos 3):
    - Problem severity: >50% dice "problema cr√≠tico"
    - Pricing sweet spot: >40% acepta ‚Ç¨30+/mes
    - Viral coefficient: >0.3
    - CAC payback: <6 meses proyectado
    - NPS intention: >50

Criterios para pivot:
  Major pivot si:
    - <20% confirma problema
    - <15% acepta pricing
    - CPL >‚Ç¨100
    - Conversion <0.5%
    
  Minor pivot si:
    - Metrics marginales pero mejorando
    - Un segmento muestra mejores n√∫meros
    - Canal espec√≠fico funciona mucho mejor
```

---

*Documento actualizado: Agosto 2025*
*Pr√≥xima revisi√≥n: Post-experimentos (Semana 4)*